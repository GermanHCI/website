{% assign pub_list = site.data.citations %}

{% assign include_link = include.link %}
{% assign style = include.style | downcase | default: "apa" %}

{% assign counter = 0 %}

<ol>
  {% for citation in pub_list %}
    {% assign formatted_title = citation.Title %}
    {% assign formatted_author_list = citation.Authors %}
    {% assign formatted_url = citation.URLs %}
    {% assign formatted_doi = citation.DOI %}
    
    {% if include_link == true %}
      {% assign url = formatted_url | prepend: "https://scholar.google.com/scholar?q=" %}
      {% capture title_link %}<a href="{{ url }}">{{ formatted_title }}</a>{% endcapture %}
    {% else %}
      {% assign title_link = formatted_title %}
    {% endif %}

    {% assign formatted_citation = title_link %}
    
    {% if formatted_author_list %}
      {% assign authors = formatted_author_list | split: ";" %}
      {% for author in authors %}
        {% if forloop.first %}
          {% assign formatted_citation = formatted_citation | append: "<br>" %}
        {% endif %}
        {% assign formatted_citation = formatted_citation | append: author %}
        {% unless forloop.last %}
          {% assign formatted_citation = formatted_citation | append: ", " %}
        {% endunless %}
      {% endfor %}
      {% assign formatted_citation = formatted_citation | append: "<br>" %}
    {% endif %}
    
    {% if formatted_url or formatted_doi %}
      {% assign formatted_citation = formatted_citation | append: "<br>" %}
    {% endif %}
    
    {% if formatted_url %}
      {% assign formatted_citation = formatted_citation | append: "URL: " | append: formatted_url %}
    {% endif %}
    
    {% if formatted_url and formatted_doi %}
      {% assign formatted_citation = formatted_citation | append: " | " %}
    {% endif %}
    
    {% if formatted_doi %}
      {% assign formatted_citation = formatted_citation | append: "DOI: " | append: formatted_doi %}
    {% endif %}

    {% if style == "apa" %}
      <li>
        {{ formatted_citation }}
      </li>
    {% endif %}

    {% if include.limit %}
      {% assign counter = counter | plus: 1 %}
      {% if counter == include.limit %}
        {% break %}
      {% endif %}
    {% endif %}
  {% endfor %}
</ol>
